<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موسوعة العلّامة رؤوف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa; /* Light grey background */
        }
        .sidebar {
            background-color: #3498db; /* Blue */
            color: white;
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.hidden {
            transform: translateX(100%); /* Hide sidebar to the right for RTL */
        }
        @media (min-width: 768px) {
            .sidebar.hidden {
                transform: translateX(0); /* Always show on desktop */
            }
        }
        .sidebar a {
            display: block;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: background-color 0.2s ease;
        }
        .sidebar a:hover, .sidebar a.active {
            background-color: #2980b9; /* Darker blue on hover/active */
        }
        .content-area {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .quiz-option {
            background-color: #ecf0f1; /* Light grey for options */
            border: 1px solid #bdc3c7;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .quiz-option:hover {
            background-color: #dde1e2;
        }
        .quiz-option.correct {
            background-color: #d4edda; /* Light green */
            border-color: #28a745; /* Green */
        }
        .quiz-option.incorrect {
            background-color: #f8d7da; /* Light red */
            border-color: #dc3545; /* Red */
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            display: none; /* Hidden by default */
        }
        .message-box button {
            background-color: #3498db;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .message-box button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-gradient-to-r from-blue-500 to-teal-500 text-white p-4 shadow-lg rounded-b-xl">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold">موسوعة العلّامة رؤوف</h1>
            <button id="menu-toggle" class="md:hidden p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>
    </header>

    <div class="flex flex-1 container mx-auto my-6 p-4 md:p-6">
        <aside id="sidebar" class="sidebar fixed inset-y-0 right-0 w-64 md:relative md:w-64 p-4 md:p-0 md:flex-shrink-0 z-40 md:z-auto rounded-l-xl md:rounded-none hidden md:block">
            <h2 class="text-2xl font-bold mb-4 text-center">المقاطع</h2>
            <nav id="main-nav">
                </nav>
        </aside>

        <main id="content-display" class="flex-1 p-6 md:mr-6 content-area">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">مرحباً بك في موسوعة العلّامة رؤوف!</h2>
            <p class="text-lg text-gray-700 leading-relaxed text-center">
                هنا ستجد محتوى غنياً وأنشطة تفاعلية لمساعدتك على فهم دروس اللغة العربية والاستعداد للامتحانات.
                اختر مقطعاً أو وحدة من القائمة الجانبية للبدء في رحلتك التعليمية الممتعة.
            </p>
            <div class="mt-8 text-center">
                <img src="https://placehold.co/400x250/3498db/ffffff?text=مرحباً+بك" alt="Welcome Image" class="mx-auto rounded-lg shadow-md">
            </div>
        </main>
    </div>

    <div id="message-box" class="message-box">
        <p id="message-text" class="text-xl font-semibold text-gray-800"></p>
        <button id="message-ok-button">حسناً</button>
    </div>

    <footer class="bg-gray-800 text-white p-4 mt-auto rounded-t-xl">
        <div class="container mx-auto text-center">
            <p>&copy; 2023 موسوعة العلّامة رؤوف. جميع الحقوق محفوظة.</p>
        </div>
    </footer>

    <script>
        // Global variables for Firebase (not used in this version, but kept for future expansion)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Function to show custom message box instead of alert/confirm
        function showMessageBox(message, callback) {
            const msgBox = document.getElementById('message-box');
            const msgText = document.getElementById('message-text');
            const okButton = document.getElementById('message-ok-button');

            msgText.textContent = message;
            msgBox.style.display = 'block';

            okButton.onclick = () => {
                msgBox.style.display = 'none';
                if (callback) callback();
            };
        }

        // Dummy content structure based on the PDF
        const encyclopediaContent = {
            "القيم الإنسانية": {
                "الوحدة الأولى: مع عصاي في المدرسة": {
                    text: `
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">مع عصاي في المدرسة</h3>
                        <p class="mb-4 leading-relaxed">رافقني أبي إلى المدرسة حيث استقبلنا المدير بكثير من اللطف، فقال أبي: "سيدي المدير، هذه ابنتي رجاء، هي كما ترى... فشكرا وجزاك الله خيرا".</p>
                        <p class="mb-4 leading-relaxed">ولدى خروجنا عرج بي أبي إلى حجرة القسم، فوجدت نفسي وسط حشد هائل لا أعرفه، جلست على مقعد خشبي، ثم تبين لي أن عصاي ليس لها مكان، إن أوقفتها ستتراءى كراية تثير الانتباه، وإن وضعتها على حافة مقعدي على طول الممر الضيق، ستعوق الذهاب والإياب، ثم لاح لي أن أدخلها عبر فجوات المقعد، وأنا أهتم بذلك، إذا بالعصا ترتطم بالمقعد، فتحدث صوتا فاجعا، فانقلبت الأنظار إلي، وسمعت خطوات المدرس، وما أراه إلا واقفا أمامي. انشطرت ضفعة جراء عملي، إلا أن المدرس لم يفعله، بل أمرني برفع رأسي، فرأيته باسما، ثم انحنى حيث العصا فأخذها ووضعها على طول مقعدي في الجهة السفلى، وقال بصوت هادئ: "لا عليك! فهذا موضعها اللائق، ومنه يتيسر عليك الاعتماد عليها كلما دعت الحاجة".</p>
                        <p class="text-sm text-gray-600 mt-4"> - جابري محمد - بتصرف</p>
                    `,
                    activities: [
                        {
                            type: "quiz",
                            question: "ما هي الكلمة التي تعبر عن النسبة في جملة 'هذا شِعارُ جَمْعِيَّةِ الْهِلَالِ الْأَحْمَرِ الْجَزَائِرِي'؟",
                            options: ["شعار", "جمعية", "الهلال", "الجزائري"],
                            correct: "الجزائري",
                            explanation: "الكلمة 'الجزائري' هي اسم نسبة يدل على الانتماء إلى الجزائر."
                        },
                        {
                            type: "quiz",
                            question: "ماذا طلب الأب من المدير بخصوص ابنته رجاء؟",
                            options: ["تسجيلها في المدرسة", "توفير مقعد خاص لها", "مساعدتها في حمل عصاها", "لا شيء مما ذكر"],
                            correct: "تسجيلها في المدرسة",
                            explanation: "الأب رافق ابنته إلى المدرسة لتسجيلها."
                        },
                        {
                            type: "text",
                            title: "ألفاظ النسبة",
                            content: `
                                <p class="mb-2">ألفاظ النسبة هي كلمات تُضاف إليها ياء مشددة مكسور ما قبلها للدلالة على الانتماء أو الصفة. مثل: مَدْرَسِيّ (من مدرسة)، خَشَبِيّ (من خشب)، جَزَائِرِيّ (من الجزائر).</p>
                                <p class="mb-2"><b>مثال:</b> هذا كتاب <b>مَدْرَسِيّ</b>. (الكتاب ينتمي إلى المدرسة)</p>
                                <p class="mb-2"><b>مثال:</b> هذه عصا <b>خَشَبِيَّة</b>. (العصا مصنوعة من الخشب)</p>
                            `
                        }
                    ]
                },
                "الوحدة الثانية: ماسح الزجاج": {
                    text: `
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">ماسح الزجاج</h3>
                        <p class="mb-4 leading-relaxed">تُرى وجهه يوميًا في الشوارع المزدحمة... أمام زجاج سيارتك... و أنت وراء المقود، يتراخى سيارتك المشغولة، لا تقوى على القرار، و أنت العالق في أزمة السير، يمسح بطولته، زجاج السيارة الأمامي بسرعة فائقة وبراعة خارقة، مهمته مسح زجاج كل سيارة عابرة.</p>
                        <p class="mb-4 leading-relaxed">ترجو هناك يخضّت أن تؤدي له أجرًا لقاء أتعاب لم تشغل القيام بها. لا يلح في طلب، ولا يُرهقك بسؤال. كثيرون يتأففون منه ولا يعطونه شيئًا، فلا يُبدي غضبا ولا عداوة. و القابلون منهم يعطونه من قطع النقد الصغيرة، ابتسامته الساحرة لا تفارق شفتيه، يزيد على عطاء من أعطيه بكلمات شكر محفوظة.</p>
                        <p class="text-sm text-gray-600 mt-4"> - إدوارد وهبه - بتصرف</p>
                    `,
                    activities: [
                        {
                            type: "quiz",
                            question: "ما هو شعور ماسح الزجاج عندما لا يعطيه الناس شيئًا؟",
                            options: ["يغضب", "يحزن", "لا يبدي غضباً ولا عداوة", "يبتسم"],
                            correct: "لا يبدي غضباً ولا عداوة",
                            explanation: "النص يذكر أنه 'لا يبدي غضبا ولا عداوة' حتى عندما لا يعطونه شيئًا."
                        },
                        {
                            type: "text",
                            title: "الفعل الماضي",
                            content: `
                                <p class="mb-2">الفعل الماضي هو فعل يدل على حدث وقع وانتهى في الزمن الماضي. مثل: <b>درس</b>، <b>كتب</b>، <b>لعب</b>.</p>
                                <p class="mb-2"><b>مثال:</b> <b>دخل</b> التلاميذ القسم. (فعل ماضٍ)</p>
                                <p class="mb-2"><b>مثال:</b> <b>مسح</b> الولد الزجاج. (فعل ماضٍ)</p>
                            `
                        }
                    ]
                }
            },
            "الحياة الإجتماعية": {
                "الوحدة الأولى: التاجماعت": {
                    text: `
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">التاجماعت</h3>
                        <p class="mb-4 leading-relaxed">التاجماعت هو مجلس محلي في منطقة القبائل بالجزائر، يضم شيوخ القرية ووجهاءها. يجتمعون لحل مشاكل القرية وتسيير شؤونها.</p>
                        <p class="mb-4 leading-relaxed">تُعد التاجماعت رمزاً للتضامن والتعاون بين أفراد المجتمع، حيث يساهم الجميع في بناء القرية وحل النزاعات وتوفير المساعدة للمحتاجين.</p>
                    `,
                    activities: [
                        {
                            type: "quiz",
                            question: "ما هي وظيفة 'التاجماعت' الرئيسية؟",
                            options: ["التعليم", "الزراعة", "حل المشاكل وتسيير شؤون القرية", "التجارة"],
                            correct: "حل المشاكل وتسيير شؤون القرية",
                            explanation: "'التاجماعت' هي مجلس محلي يحل مشاكل القرية ويسير شؤونها."
                        }
                    ]
                }
            }
            // More sections and units would go here
        };

        // Function to render content
        function renderContent(unitData) {
            const contentDisplay = document.getElementById('content-display');
            contentDisplay.innerHTML = `
                <div class="p-6">
                    ${unitData.text}
                    <hr class="my-6 border-gray-300">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">الأنشطة التفاعلية</h3>
                    <div id="activities-container"></div>
                </div>
            `;

            const activitiesContainer = document.getElementById('activities-container');
            unitData.activities.forEach((activity, index) => {
                if (activity.type === "quiz") {
                    const quizHtml = `
                        <div class="bg-blue-50 p-5 rounded-lg shadow-md mb-6">
                            <p class="text-xl font-semibold text-blue-800 mb-4">السؤال ${index + 1}: ${activity.question}</p>
                            <div class="options-container">
                                ${activity.options.map((option, i) => `
                                    <div class="quiz-option" data-answer="${option}" data-correct="${activity.correct === option ? 'true' : 'false'}">
                                        ${option}
                                    </div>
                                `).join('')}
                            </div>
                            <p class="feedback-message text-center mt-3 font-medium hidden"></p>
                            <p class="explanation-message text-center mt-3 text-gray-600 hidden">${activity.explanation}</p>
                        </div>
                    `;
                    activitiesContainer.innerHTML += quizHtml;
                } else if (activity.type === "text") {
                    const textActivityHtml = `
                        <div class="bg-green-50 p-5 rounded-lg shadow-md mb-6">
                            <h4 class="text-xl font-semibold text-green-800 mb-3">${activity.title}</h4>
                            ${activity.content}
                        </div>
                    `;
                    activitiesContainer.innerHTML += textActivityHtml;
                }
            });

            // Add event listeners for quiz options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    const parentQuiz = this.closest('.bg-blue-50');
                    const options = parentQuiz.querySelectorAll('.quiz-option');
                    const feedbackMessage = parentQuiz.querySelector('.feedback-message');
                    const explanationMessage = parentQuiz.querySelector('.explanation-message');

                    // Disable all options after one is clicked
                    options.forEach(opt => {
                        opt.style.pointerEvents = 'none';
                    });

                    if (this.dataset.correct === 'true') {
                        this.classList.add('correct');
                        feedbackMessage.textContent = 'إجابة صحيحة! 🎉';
                        feedbackMessage.classList.remove('text-red-600', 'hidden');
                        feedbackMessage.classList.add('text-green-600', 'block');
                    } else {
                        this.classList.add('incorrect');
                        feedbackMessage.textContent = 'إجابة خاطئة. حاول مرة أخرى.';
                        feedbackMessage.classList.remove('text-green-600', 'hidden');
                        feedbackMessage.classList.add('text-red-600', 'block');
                        // Highlight the correct answer
                        options.forEach(opt => {
                            if (opt.dataset.correct === 'true') {
                                opt.classList.add('correct');
                            }
                        });
                    }
                    explanationMessage.classList.remove('hidden');
                    explanationMessage.classList.add('block');
                });
            });
        }

        // Function to build navigation
        function buildNavigation() {
            const nav = document.getElementById('main-nav');
            nav.innerHTML = ''; // Clear existing nav

            for (const sectionTitle in encyclopediaContent) {
                const sectionLink = document.createElement('a');
                sectionLink.href = "#";
                sectionLink.textContent = sectionTitle;
                sectionLink.classList.add('font-bold', 'text-lg', 'mb-2', 'block', 'text-white', 'hover:bg-blue-600', 'rounded-lg', 'p-2');
                sectionLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleSidebar(); // Hide sidebar on mobile after selection
                    renderSection(sectionTitle);
                });
                nav.appendChild(sectionLink);

                const units = encyclopediaContent[sectionTitle];
                for (const unitTitle in units) {
                    const unitLink = document.createElement('a');
                    unitLink.href = "#";
                    unitLink.textContent = `• ${unitTitle}`;
                    unitLink.classList.add('text-md', 'mr-4', 'block', 'text-white', 'hover:bg-blue-600', 'rounded-lg', 'p-2');
                    unitLink.dataset.section = sectionTitle;
                    unitLink.dataset.unit = unitTitle;
                    unitLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Remove active class from all links
                        document.querySelectorAll('#main-nav a').forEach(link => link.classList.remove('active'));
                        // Add active class to the clicked link
                        unitLink.classList.add('active');
                        toggleSidebar(); // Hide sidebar on mobile after selection
                        renderContent(encyclopediaContent[sectionTitle][unitTitle]);
                    });
                    nav.appendChild(unitLink);
                }
            }
        }

        function renderSection(sectionTitle) {
            const contentDisplay = document.getElementById('content-display');
            let sectionHtml = `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">${sectionTitle}</h2>
                <p class="text-lg text-gray-700 leading-relaxed mb-8 text-center">
                    استكشف الوحدات المختلفة ضمن هذا المقطع:
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            `;

            const units = encyclopediaContent[sectionTitle];
            for (const unitTitle in units) {
                sectionHtml += `
                    <div class="bg-blue-100 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 cursor-pointer"
                         data-section="${sectionTitle}" data-unit="${unitTitle}">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">${unitTitle}</h3>
                        <p class="text-gray-700 text-sm">انقر للاستكشاف</p>
                    </div>
                `;
            }
            sectionHtml += `</div>`;
            contentDisplay.innerHTML = sectionHtml;

            // Add event listeners for unit cards
            document.querySelectorAll('.grid > div').forEach(card => {
                card.addEventListener('click', function() {
                    const section = this.dataset.section;
                    const unit = this.dataset.unit;
                    // Set active class on the corresponding sidebar link
                    document.querySelectorAll('#main-nav a').forEach(link => {
                        if (link.dataset.section === section && link.dataset.unit === unit) {
                            link.classList.add('active');
                        } else {
                            link.classList.remove('active');
                        }
                    });
                    renderContent(encyclopediaContent[section][unit]);
                });
            });
        }


        // Sidebar toggle functionality for mobile
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');

        function toggleSidebar() {
            sidebar.classList.toggle('hidden');
            if (!sidebar.classList.contains('hidden')) {
                // If sidebar is shown, add an overlay to click outside
                const overlay = document.createElement('div');
                overlay.id = 'sidebar-overlay';
                overlay.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-50', 'z-30', 'md:hidden');
                document.body.appendChild(overlay);
                overlay.addEventListener('click', toggleSidebar);
            } else {
                // If sidebar is hidden, remove the overlay
                const overlay = document.getElementById('sidebar-overlay');
                if (overlay) {
                    overlay.remove();
                }
            }
        }

        menuToggle.addEventListener('click', toggleSidebar);

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            buildNavigation();
            // Hide sidebar on small screens by default but allow it to be toggled
            if (window.innerWidth < 768) {
                sidebar.classList.add('hidden');
            }
        });

        // LLM Integration Placeholder (for future activities like generating more questions)
        async function generateMoreQuestions(topic) {
            showMessageBox("جاري إنشاء المزيد من الأسئلة، يرجى الانتظار...", null);
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: `Generate 3 multiple choice questions in Arabic about "${topic}" for fourth-grade primary students. Provide the question, 4 options, and the correct answer. Format as JSON.` }] });
            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "question": { "type": "STRING" },
                                "options": { "type": "ARRAY", "items": { "type": "STRING" } },
                                "correctAnswer": { "type": "STRING" }
                            },
                            "propertyOrdering": ["question", "options", "correctAnswer"]
                        }
                    }
                }
            };
            const apiKey = ""; // Canvas will provide this at runtime
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(json);
                    // Here you would integrate these new questions into the current unit's activities
                    console.log("Generated Questions:", parsedJson);
                    showMessageBox("تم إنشاء أسئلة جديدة بنجاح! يمكنك دمجها في الأنشطة.", null);
                    // For demonstration, let's just log and add a placeholder to the current view
                    const activitiesContainer = document.getElementById('activities-container');
                    if (activitiesContainer) {
                        let newQuestionsHtml = `
                            <div class="bg-yellow-50 p-5 rounded-lg shadow-md mt-6">
                                <h4 class="text-xl font-semibold text-yellow-800 mb-3">أسئلة إضافية (تم إنشاؤها)</h4>
                                <ul class="list-disc pr-5">
                        `;
                        parsedJson.forEach(q => {
                            newQuestionsHtml += `<li><p class="font-medium">${q.question}</p><ul class="list-circle pr-5 text-sm">`;
                            q.options.forEach(opt => newQuestionsHtml += `<li>${opt}</li>`);
                            newQuestionsHtml += `</ul><p class="text-green-700 text-sm">الإجابة الصحيحة: ${q.correctAnswer}</p></li>`;
                        });
                        newQuestionsHtml += `</ul></div>`;
                        activitiesContainer.innerHTML += newQuestionsHtml;
                    }

                } else {
                    showMessageBox("حدث خطأ في إنشاء الأسئلة: لا توجد بيانات مرشحة.", null);
                }
            } catch (error) {
                console.error("Error generating questions:", error);
                showMessageBox(`حدث خطأ أثناء إنشاء الأسئلة: ${error.message}`, null);
            }
        }

        // Example of how to call generateMoreQuestions (you could add a button for this)
        // setTimeout(() => generateMoreQuestions("الفعل الماضي"), 5000); // Call after 5 seconds for testing
    </script>
</body>
</html>
