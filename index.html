<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุณูุนุฉ ุงูุนููุงูุฉ ุฑุคูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f8f9fa; /* Light grey background */
        }
        .sidebar {
            background-color: #3498db; /* Blue */
            color: white;
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.hidden {
            transform: translateX(100%); /* Hide sidebar to the right for RTL */
        }
        @media (min-width: 768px) {
            .sidebar.hidden {
                transform: translateX(0); /* Always show on desktop */
            }
        }
        .sidebar a {
            display: block;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: background-color 0.2s ease;
        }
        .sidebar a:hover, .sidebar a.active {
            background-color: #2980b9; /* Darker blue on hover/active */
        }
        .content-area {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .quiz-option {
            background-color: #ecf0f1; /* Light grey for options */
            border: 1px solid #bdc3c7;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .quiz-option:hover {
            background-color: #dde1e2;
        }
        .quiz-option.correct {
            background-color: #d4edda; /* Light green */
            border-color: #28a745; /* Green */
        }
        .quiz-option.incorrect {
            background-color: #f8d7da; /* Light red */
            border-color: #dc3545; /* Red */
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            text-align: center;
            max-width: 90%;
            display: none; /* Hidden by default */
        }
        .message-box button {
            background-color: #3498db;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .message-box button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-gradient-to-r from-blue-500 to-teal-500 text-white p-4 shadow-lg rounded-b-xl">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold">ููุณูุนุฉ ุงูุนููุงูุฉ ุฑุคูู</h1>
            <button id="menu-toggle" class="md:hidden p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-white">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
        </div>
    </header>

    <div class="flex flex-1 container mx-auto my-6 p-4 md:p-6">
        <aside id="sidebar" class="sidebar fixed inset-y-0 right-0 w-64 md:relative md:w-64 p-4 md:p-0 md:flex-shrink-0 z-40 md:z-auto rounded-l-xl md:rounded-none hidden md:block">
            <h2 class="text-2xl font-bold mb-4 text-center">ุงูููุงุทุน</h2>
            <nav id="main-nav">
                </nav>
        </aside>

        <main id="content-display" class="flex-1 p-6 md:mr-6 content-area">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">ูุฑุญุจุงู ุจู ูู ููุณูุนุฉ ุงูุนููุงูุฉ ุฑุคูู!</h2>
            <p class="text-lg text-gray-700 leading-relaxed text-center">
                ููุง ุณุชุฌุฏ ูุญุชูู ุบููุงู ูุฃูุดุทุฉ ุชูุงุนููุฉ ููุณุงุนุฏุชู ุนูู ููู ุฏุฑูุณ ุงููุบุฉ ุงูุนุฑุจูุฉ ูุงูุงุณุชุนุฏุงุฏ ููุงูุชุญุงูุงุช.
                ุงุฎุชุฑ ููุทุนุงู ุฃู ูุญุฏุฉ ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุจุฏุก ูู ุฑุญูุชู ุงูุชุนููููุฉ ุงูููุชุนุฉ.
            </p>
            <div class="mt-8 text-center">
                <img src="https://placehold.co/400x250/3498db/ffffff?text=ูุฑุญุจุงู+ุจู" alt="Welcome Image" class="mx-auto rounded-lg shadow-md">
            </div>
        </main>
    </div>

    <div id="message-box" class="message-box">
        <p id="message-text" class="text-xl font-semibold text-gray-800"></p>
        <button id="message-ok-button">ุญุณูุงู</button>
    </div>

    <footer class="bg-gray-800 text-white p-4 mt-auto rounded-t-xl">
        <div class="container mx-auto text-center">
            <p>&copy; 2023 ููุณูุนุฉ ุงูุนููุงูุฉ ุฑุคูู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
        </div>
    </footer>

    <script>
        // Global variables for Firebase (not used in this version, but kept for future expansion)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Function to show custom message box instead of alert/confirm
        function showMessageBox(message, callback) {
            const msgBox = document.getElementById('message-box');
            const msgText = document.getElementById('message-text');
            const okButton = document.getElementById('message-ok-button');

            msgText.textContent = message;
            msgBox.style.display = 'block';

            okButton.onclick = () => {
                msgBox.style.display = 'none';
                if (callback) callback();
            };
        }

        // Dummy content structure based on the PDF
        const encyclopediaContent = {
            "ุงูููู ุงูุฅูุณุงููุฉ": {
                "ุงููุญุฏุฉ ุงูุฃููู: ูุน ุนุตุงู ูู ุงููุฏุฑุณุฉ": {
                    text: `
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">ูุน ุนุตุงู ูู ุงููุฏุฑุณุฉ</h3>
                        <p class="mb-4 leading-relaxed">ุฑุงูููู ุฃุจู ุฅูู ุงููุฏุฑุณุฉ ุญูุซ ุงุณุชูุจููุง ุงููุฏูุฑ ุจูุซูุฑ ูู ุงููุทูุ ููุงู ุฃุจู: "ุณูุฏู ุงููุฏูุฑุ ูุฐู ุงุจูุชู ุฑุฌุงุกุ ูู ููุง ุชุฑู... ูุดูุฑุง ูุฌุฒุงู ุงููู ุฎูุฑุง".</p>
                        <p class="mb-4 leading-relaxed">ููุฏู ุฎุฑูุฌูุง ุนุฑุฌ ุจู ุฃุจู ุฅูู ุญุฌุฑุฉ ุงููุณูุ ููุฌุฏุช ููุณู ูุณุท ุญุดุฏ ูุงุฆู ูุง ุฃุนุฑููุ ุฌูุณุช ุนูู ููุนุฏ ุฎุดุจูุ ุซู ุชุจูู ูู ุฃู ุนุตุงู ููุณ ููุง ููุงูุ ุฅู ุฃูููุชูุง ุณุชุชุฑุงุกู ูุฑุงูุฉ ุชุซูุฑ ุงูุงูุชุจุงูุ ูุฅู ูุถุนุชูุง ุนูู ุญุงูุฉ ููุนุฏู ุนูู ุทูู ุงูููุฑ ุงูุถููุ ุณุชุนูู ุงูุฐูุงุจ ูุงูุฅูุงุจุ ุซู ูุงุญ ูู ุฃู ุฃุฏุฎููุง ุนุจุฑ ูุฌูุงุช ุงูููุนุฏุ ูุฃูุง ุฃูุชู ุจุฐููุ ุฅุฐุง ุจุงูุนุตุง ุชุฑุชุทู ุจุงูููุนุฏุ ูุชุญุฏุซ ุตูุชุง ูุงุฌุนุงุ ูุงูููุจุช ุงูุฃูุธุงุฑ ุฅููุ ูุณูุนุช ุฎุทูุงุช ุงููุฏุฑุณุ ููุง ุฃุฑุงู ุฅูุง ูุงููุง ุฃูุงูู. ุงูุดุทุฑุช ุถูุนุฉ ุฌุฑุงุก ุนูููุ ุฅูุง ุฃู ุงููุฏุฑุณ ูู ููุนููุ ุจู ุฃูุฑูู ุจุฑูุน ุฑุฃุณูุ ูุฑุฃูุชู ุจุงุณูุงุ ุซู ุงูุญูู ุญูุซ ุงูุนุตุง ูุฃุฎุฐูุง ููุถุนูุง ุนูู ุทูู ููุนุฏู ูู ุงูุฌูุฉ ุงูุณูููุ ููุงู ุจุตูุช ูุงุฏุฆ: "ูุง ุนููู! ููุฐุง ููุถุนูุง ุงููุงุฆูุ ูููู ูุชูุณุฑ ุนููู ุงูุงุนุชูุงุฏ ุนูููุง ูููุง ุฏุนุช ุงูุญุงุฌุฉ".</p>
                        <p class="text-sm text-gray-600 mt-4"> - ุฌุงุจุฑู ูุญูุฏ - ุจุชุตุฑู</p>
                    `,
                    activities: [
                        {
                            type: "quiz",
                            question: "ูุง ูู ุงููููุฉ ุงูุชู ุชุนุจุฑ ุนู ุงููุณุจุฉ ูู ุฌููุฉ 'ูุฐุง ุดูุนุงุฑู ุฌูููุนููููุฉู ุงููููููุงูู ุงููุฃูุญูููุฑู ุงููุฌูุฒูุงุฆูุฑูู'ุ",
                            options: ["ุดุนุงุฑ", "ุฌูุนูุฉ", "ุงูููุงู", "ุงูุฌุฒุงุฆุฑู"],
                            correct: "ุงูุฌุฒุงุฆุฑู",
                            explanation: "ุงููููุฉ 'ุงูุฌุฒุงุฆุฑู' ูู ุงุณู ูุณุจุฉ ูุฏู ุนูู ุงูุงูุชูุงุก ุฅูู ุงูุฌุฒุงุฆุฑ."
                        },
                        {
                            type: "quiz",
                            question: "ูุงุฐุง ุทูุจ ุงูุฃุจ ูู ุงููุฏูุฑ ุจุฎุตูุต ุงุจูุชู ุฑุฌุงุกุ",
                            options: ["ุชุณุฌูููุง ูู ุงููุฏุฑุณุฉ", "ุชูููุฑ ููุนุฏ ุฎุงุต ููุง", "ูุณุงุนุฏุชูุง ูู ุญูู ุนุตุงูุง", "ูุง ุดูุก ููุง ุฐูุฑ"],
                            correct: "ุชุณุฌูููุง ูู ุงููุฏุฑุณุฉ",
                            explanation: "ุงูุฃุจ ุฑุงูู ุงุจูุชู ุฅูู ุงููุฏุฑุณุฉ ูุชุณุฌูููุง."
                        },
                        {
                            type: "text",
                            title: "ุฃููุงุธ ุงููุณุจุฉ",
                            content: `
                                <p class="mb-2">ุฃููุงุธ ุงููุณุจุฉ ูู ูููุงุช ุชูุถุงู ุฅูููุง ูุงุก ูุดุฏุฏุฉ ููุณูุฑ ูุง ูุจููุง ููุฏูุงูุฉ ุนูู ุงูุงูุชูุงุก ุฃู ุงูุตูุฉ. ูุซู: ููุฏูุฑูุณููู (ูู ูุฏุฑุณุฉ)ุ ุฎูุดูุจููู (ูู ุฎุดุจ)ุ ุฌูุฒูุงุฆูุฑููู (ูู ุงูุฌุฒุงุฆุฑ).</p>
                                <p class="mb-2"><b>ูุซุงู:</b> ูุฐุง ูุชุงุจ <b>ููุฏูุฑูุณููู</b>. (ุงููุชุงุจ ููุชูู ุฅูู ุงููุฏุฑุณุฉ)</p>
                                <p class="mb-2"><b>ูุซุงู:</b> ูุฐู ุนุตุง <b>ุฎูุดูุจููููุฉ</b>. (ุงูุนุตุง ูุตููุนุฉ ูู ุงูุฎุดุจ)</p>
                            `
                        }
                    ]
                },
                "ุงููุญุฏุฉ ุงูุซุงููุฉ: ูุงุณุญ ุงูุฒุฌุงุฌ": {
                    text: `
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">ูุงุณุญ ุงูุฒุฌุงุฌ</h3>
                        <p class="mb-4 leading-relaxed">ุชูุฑู ูุฌูู ูููููุง ูู ุงูุดูุงุฑุน ุงููุฒุฏุญูุฉ... ุฃูุงู ุฒุฌุงุฌ ุณูุงุฑุชู... ู ุฃูุช ูุฑุงุก ุงููููุฏุ ูุชุฑุงุฎู ุณูุงุฑุชู ุงููุดุบููุฉุ ูุง ุชููู ุนูู ุงููุฑุงุฑุ ู ุฃูุช ุงูุนุงูู ูู ุฃุฒูุฉ ุงูุณูุฑุ ููุณุญ ุจุทููุชูุ ุฒุฌุงุฌ ุงูุณูุงุฑุฉ ุงูุฃูุงูู ุจุณุฑุนุฉ ูุงุฆูุฉ ูุจุฑุงุนุฉ ุฎุงุฑูุฉุ ูููุชู ูุณุญ ุฒุฌุงุฌ ูู ุณูุงุฑุฉ ุนุงุจุฑุฉ.</p>
                        <p class="mb-4 leading-relaxed">ุชุฑุฌู ููุงู ูุฎุถูุช ุฃู ุชุคุฏู ูู ุฃุฌุฑูุง ููุงุก ุฃุชุนุงุจ ูู ุชุดุบู ุงูููุงู ุจูุง. ูุง ููุญ ูู ุทูุจุ ููุง ููุฑููู ุจุณุคุงู. ูุซูุฑูู ูุชุฃูููู ููู ููุง ูุนุทููู ุดูุฆูุงุ ููุง ููุจุฏู ุบุถุจุง ููุง ุนุฏุงูุฉ. ู ุงููุงุจููู ูููู ูุนุทููู ูู ูุทุน ุงูููุฏ ุงูุตุบูุฑุฉุ ุงุจุชุณุงูุชู ุงูุณุงุญุฑุฉ ูุง ุชูุงุฑู ุดูุชููุ ูุฒูุฏ ุนูู ุนุทุงุก ูู ุฃุนุทูู ุจูููุงุช ุดูุฑ ูุญููุธุฉ.</p>
                        <p class="text-sm text-gray-600 mt-4"> - ุฅุฏูุงุฑุฏ ููุจู - ุจุชุตุฑู</p>
                    `,
                    activities: [
                        {
                            type: "quiz",
                            question: "ูุง ูู ุดุนูุฑ ูุงุณุญ ุงูุฒุฌุงุฌ ุนูุฏูุง ูุง ูุนุทูู ุงููุงุณ ุดูุฆูุงุ",
                            options: ["ูุบุถุจ", "ูุญุฒู", "ูุง ูุจุฏู ุบุถุจุงู ููุง ุนุฏุงูุฉ", "ูุจุชุณู"],
                            correct: "ูุง ูุจุฏู ุบุถุจุงู ููุง ุนุฏุงูุฉ",
                            explanation: "ุงููุต ูุฐูุฑ ุฃูู 'ูุง ูุจุฏู ุบุถุจุง ููุง ุนุฏุงูุฉ' ุญุชู ุนูุฏูุง ูุง ูุนุทููู ุดูุฆูุง."
                        },
                        {
                            type: "text",
                            title: "ุงููุนู ุงููุงุถู",
                            content: `
                                <p class="mb-2">ุงููุนู ุงููุงุถู ูู ูุนู ูุฏู ุนูู ุญุฏุซ ููุน ูุงูุชูู ูู ุงูุฒูู ุงููุงุถู. ูุซู: <b>ุฏุฑุณ</b>ุ <b>ูุชุจ</b>ุ <b>ูุนุจ</b>.</p>
                                <p class="mb-2"><b>ูุซุงู:</b> <b>ุฏุฎู</b> ุงูุชูุงููุฐ ุงููุณู. (ูุนู ูุงุถู)</p>
                                <p class="mb-2"><b>ูุซุงู:</b> <b>ูุณุญ</b> ุงูููุฏ ุงูุฒุฌุงุฌ. (ูุนู ูุงุถู)</p>
                            `
                        }
                    ]
                }
            },
            "ุงูุญูุงุฉ ุงูุฅุฌุชูุงุนูุฉ": {
                "ุงููุญุฏุฉ ุงูุฃููู: ุงูุชุงุฌูุงุนุช": {
                    text: `
                        <h3 class="text-2xl font-semibold mb-3 text-blue-700">ุงูุชุงุฌูุงุนุช</h3>
                        <p class="mb-4 leading-relaxed">ุงูุชุงุฌูุงุนุช ูู ูุฌูุณ ูุญูู ูู ููุทูุฉ ุงููุจุงุฆู ุจุงูุฌุฒุงุฆุฑุ ูุถู ุดููุฎ ุงููุฑูุฉ ููุฌูุงุกูุง. ูุฌุชูุนูู ูุญู ูุดุงูู ุงููุฑูุฉ ูุชุณููุฑ ุดุคูููุง.</p>
                        <p class="mb-4 leading-relaxed">ุชูุนุฏ ุงูุชุงุฌูุงุนุช ุฑูุฒุงู ููุชุถุงูู ูุงูุชุนุงูู ุจูู ุฃูุฑุงุฏ ุงููุฌุชูุนุ ุญูุซ ูุณุงูู ุงูุฌููุน ูู ุจูุงุก ุงููุฑูุฉ ูุญู ุงููุฒุงุนุงุช ูุชูููุฑ ุงููุณุงุนุฏุฉ ูููุญุชุงุฌูู.</p>
                    `,
                    activities: [
                        {
                            type: "quiz",
                            question: "ูุง ูู ูุธููุฉ 'ุงูุชุงุฌูุงุนุช' ุงูุฑุฆูุณูุฉุ",
                            options: ["ุงูุชุนููู", "ุงูุฒุฑุงุนุฉ", "ุญู ุงููุดุงูู ูุชุณููุฑ ุดุคูู ุงููุฑูุฉ", "ุงูุชุฌุงุฑุฉ"],
                            correct: "ุญู ุงููุดุงูู ูุชุณููุฑ ุดุคูู ุงููุฑูุฉ",
                            explanation: "'ุงูุชุงุฌูุงุนุช' ูู ูุฌูุณ ูุญูู ูุญู ูุดุงูู ุงููุฑูุฉ ููุณูุฑ ุดุคูููุง."
                        }
                    ]
                }
            }
            // More sections and units would go here
        };

        // Function to render content
        function renderContent(unitData) {
            const contentDisplay = document.getElementById('content-display');
            contentDisplay.innerHTML = `
                <div class="p-6">
                    ${unitData.text}
                    <hr class="my-6 border-gray-300">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">ุงูุฃูุดุทุฉ ุงูุชูุงุนููุฉ</h3>
                    <div id="activities-container"></div>
                </div>
            `;

            const activitiesContainer = document.getElementById('activities-container');
            unitData.activities.forEach((activity, index) => {
                if (activity.type === "quiz") {
                    const quizHtml = `
                        <div class="bg-blue-50 p-5 rounded-lg shadow-md mb-6">
                            <p class="text-xl font-semibold text-blue-800 mb-4">ุงูุณุคุงู ${index + 1}: ${activity.question}</p>
                            <div class="options-container">
                                ${activity.options.map((option, i) => `
                                    <div class="quiz-option" data-answer="${option}" data-correct="${activity.correct === option ? 'true' : 'false'}">
                                        ${option}
                                    </div>
                                `).join('')}
                            </div>
                            <p class="feedback-message text-center mt-3 font-medium hidden"></p>
                            <p class="explanation-message text-center mt-3 text-gray-600 hidden">${activity.explanation}</p>
                        </div>
                    `;
                    activitiesContainer.innerHTML += quizHtml;
                } else if (activity.type === "text") {
                    const textActivityHtml = `
                        <div class="bg-green-50 p-5 rounded-lg shadow-md mb-6">
                            <h4 class="text-xl font-semibold text-green-800 mb-3">${activity.title}</h4>
                            ${activity.content}
                        </div>
                    `;
                    activitiesContainer.innerHTML += textActivityHtml;
                }
            });

            // Add event listeners for quiz options
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.addEventListener('click', function() {
                    const parentQuiz = this.closest('.bg-blue-50');
                    const options = parentQuiz.querySelectorAll('.quiz-option');
                    const feedbackMessage = parentQuiz.querySelector('.feedback-message');
                    const explanationMessage = parentQuiz.querySelector('.explanation-message');

                    // Disable all options after one is clicked
                    options.forEach(opt => {
                        opt.style.pointerEvents = 'none';
                    });

                    if (this.dataset.correct === 'true') {
                        this.classList.add('correct');
                        feedbackMessage.textContent = 'ุฅุฌุงุจุฉ ุตุญูุญุฉ! ๐';
                        feedbackMessage.classList.remove('text-red-600', 'hidden');
                        feedbackMessage.classList.add('text-green-600', 'block');
                    } else {
                        this.classList.add('incorrect');
                        feedbackMessage.textContent = 'ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุญุงูู ูุฑุฉ ุฃุฎุฑู.';
                        feedbackMessage.classList.remove('text-green-600', 'hidden');
                        feedbackMessage.classList.add('text-red-600', 'block');
                        // Highlight the correct answer
                        options.forEach(opt => {
                            if (opt.dataset.correct === 'true') {
                                opt.classList.add('correct');
                            }
                        });
                    }
                    explanationMessage.classList.remove('hidden');
                    explanationMessage.classList.add('block');
                });
            });
        }

        // Function to build navigation
        function buildNavigation() {
            const nav = document.getElementById('main-nav');
            nav.innerHTML = ''; // Clear existing nav

            for (const sectionTitle in encyclopediaContent) {
                const sectionLink = document.createElement('a');
                sectionLink.href = "#";
                sectionLink.textContent = sectionTitle;
                sectionLink.classList.add('font-bold', 'text-lg', 'mb-2', 'block', 'text-white', 'hover:bg-blue-600', 'rounded-lg', 'p-2');
                sectionLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    toggleSidebar(); // Hide sidebar on mobile after selection
                    renderSection(sectionTitle);
                });
                nav.appendChild(sectionLink);

                const units = encyclopediaContent[sectionTitle];
                for (const unitTitle in units) {
                    const unitLink = document.createElement('a');
                    unitLink.href = "#";
                    unitLink.textContent = `โข ${unitTitle}`;
                    unitLink.classList.add('text-md', 'mr-4', 'block', 'text-white', 'hover:bg-blue-600', 'rounded-lg', 'p-2');
                    unitLink.dataset.section = sectionTitle;
                    unitLink.dataset.unit = unitTitle;
                    unitLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Remove active class from all links
                        document.querySelectorAll('#main-nav a').forEach(link => link.classList.remove('active'));
                        // Add active class to the clicked link
                        unitLink.classList.add('active');
                        toggleSidebar(); // Hide sidebar on mobile after selection
                        renderContent(encyclopediaContent[sectionTitle][unitTitle]);
                    });
                    nav.appendChild(unitLink);
                }
            }
        }

        function renderSection(sectionTitle) {
            const contentDisplay = document.getElementById('content-display');
            let sectionHtml = `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">${sectionTitle}</h2>
                <p class="text-lg text-gray-700 leading-relaxed mb-8 text-center">
                    ุงุณุชูุดู ุงููุญุฏุงุช ุงููุฎุชููุฉ ุถูู ูุฐุง ุงูููุทุน:
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            `;

            const units = encyclopediaContent[sectionTitle];
            for (const unitTitle in units) {
                sectionHtml += `
                    <div class="bg-blue-100 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 cursor-pointer"
                         data-section="${sectionTitle}" data-unit="${unitTitle}">
                        <h3 class="text-xl font-semibold text-blue-800 mb-2">${unitTitle}</h3>
                        <p class="text-gray-700 text-sm">ุงููุฑ ููุงุณุชูุดุงู</p>
                    </div>
                `;
            }
            sectionHtml += `</div>`;
            contentDisplay.innerHTML = sectionHtml;

            // Add event listeners for unit cards
            document.querySelectorAll('.grid > div').forEach(card => {
                card.addEventListener('click', function() {
                    const section = this.dataset.section;
                    const unit = this.dataset.unit;
                    // Set active class on the corresponding sidebar link
                    document.querySelectorAll('#main-nav a').forEach(link => {
                        if (link.dataset.section === section && link.dataset.unit === unit) {
                            link.classList.add('active');
                        } else {
                            link.classList.remove('active');
                        }
                    });
                    renderContent(encyclopediaContent[section][unit]);
                });
            });
        }


        // Sidebar toggle functionality for mobile
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');

        function toggleSidebar() {
            sidebar.classList.toggle('hidden');
            if (!sidebar.classList.contains('hidden')) {
                // If sidebar is shown, add an overlay to click outside
                const overlay = document.createElement('div');
                overlay.id = 'sidebar-overlay';
                overlay.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-50', 'z-30', 'md:hidden');
                document.body.appendChild(overlay);
                overlay.addEventListener('click', toggleSidebar);
            } else {
                // If sidebar is hidden, remove the overlay
                const overlay = document.getElementById('sidebar-overlay');
                if (overlay) {
                    overlay.remove();
                }
            }
        }

        menuToggle.addEventListener('click', toggleSidebar);

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            buildNavigation();
            // Hide sidebar on small screens by default but allow it to be toggled
            if (window.innerWidth < 768) {
                sidebar.classList.add('hidden');
            }
        });

        // LLM Integration Placeholder (for future activities like generating more questions)
        async function generateMoreQuestions(topic) {
            showMessageBox("ุฌุงุฑู ุฅูุดุงุก ุงููุฒูุฏ ูู ุงูุฃุณุฆูุฉุ ูุฑุฌู ุงูุงูุชุธุงุฑ...", null);
            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: `Generate 3 multiple choice questions in Arabic about "${topic}" for fourth-grade primary students. Provide the question, 4 options, and the correct answer. Format as JSON.` }] });
            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                "question": { "type": "STRING" },
                                "options": { "type": "ARRAY", "items": { "type": "STRING" } },
                                "correctAnswer": { "type": "STRING" }
                            },
                            "propertyOrdering": ["question", "options", "correctAnswer"]
                        }
                    }
                }
            };
            const apiKey = ""; // Canvas will provide this at runtime
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    const parsedJson = JSON.parse(json);
                    // Here you would integrate these new questions into the current unit's activities
                    console.log("Generated Questions:", parsedJson);
                    showMessageBox("ุชู ุฅูุดุงุก ุฃุณุฆูุฉ ุฌุฏูุฏุฉ ุจูุฌุงุญ! ููููู ุฏูุฌูุง ูู ุงูุฃูุดุทุฉ.", null);
                    // For demonstration, let's just log and add a placeholder to the current view
                    const activitiesContainer = document.getElementById('activities-container');
                    if (activitiesContainer) {
                        let newQuestionsHtml = `
                            <div class="bg-yellow-50 p-5 rounded-lg shadow-md mt-6">
                                <h4 class="text-xl font-semibold text-yellow-800 mb-3">ุฃุณุฆูุฉ ุฅุถุงููุฉ (ุชู ุฅูุดุงุคูุง)</h4>
                                <ul class="list-disc pr-5">
                        `;
                        parsedJson.forEach(q => {
                            newQuestionsHtml += `<li><p class="font-medium">${q.question}</p><ul class="list-circle pr-5 text-sm">`;
                            q.options.forEach(opt => newQuestionsHtml += `<li>${opt}</li>`);
                            newQuestionsHtml += `</ul><p class="text-green-700 text-sm">ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ: ${q.correctAnswer}</p></li>`;
                        });
                        newQuestionsHtml += `</ul></div>`;
                        activitiesContainer.innerHTML += newQuestionsHtml;
                    }

                } else {
                    showMessageBox("ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฃุณุฆูุฉ: ูุง ุชูุฌุฏ ุจูุงูุงุช ูุฑุดุญุฉ.", null);
                }
            } catch (error) {
                console.error("Error generating questions:", error);
                showMessageBox(`ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูุฃุณุฆูุฉ: ${error.message}`, null);
            }
        }

        // Example of how to call generateMoreQuestions (you could add a button for this)
        // setTimeout(() => generateMoreQuestions("ุงููุนู ุงููุงุถู"), 5000); // Call after 5 seconds for testing
    </script>
</body>
</html>
